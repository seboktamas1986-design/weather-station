<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DS18B20 Hőmérséklet</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
  #lastTemp { font-size: 2em; margin-bottom: 20px; }
  canvas { max-width: 100%; }
</style>
</head>
<body>

<h1>Otthoni kültéri hőmérséklet</h1>
<div id="lastTemp">Betöltés...</div>
<canvas id="tempChart"></canvas>

<script>
const apiKey = 'XG3F9TP24AF5QF8A'; // a saját Thingspeak API kulcsod
const channelId = '3053905'; // a Thingspeak csatorna azonosítója
const updateInterval = 15000; // 15 mp-ként frissítjük az adatot

let chart;
let timeLabels = [];
let tempData = [];

// Funkció a Thingspeak adatok lekérésére
async function fetchData() {
    try {
        const response = await fetch(`https://api.thingspeak.com/channels/${channelId}/fields/1.json?api_key=${apiKey}&results=20`);
        const data = await response.json();
        const feeds = data.feeds;

        // Frissítjük a numerikus értéket
        const lastTemp = feeds[feeds.length - 1].field1;
        document.getElementById('lastTemp').innerText = `${lastTemp} °C`;

        // Adatok a grafikonhoz
        timeLabels = feeds.map(f => new Date(f.created_at).toLocaleTimeString());
        tempData = feeds.map(f => parseFloat(f.field1));

        updateChart();
    } catch (err) {
        console.error(err);
        document.getElementById('lastTemp').innerText = 'Hiba az adatok lekérésekor';
    }
}

// Grafikon inicializálása / frissítése
function updateChart() {
    if (!chart) {
        const ctx = document.getElementById('tempChart').getContext('2d');
        chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: timeLabels,
                datasets: [{
                    label: 'Hőmérséklet (°C)',
                    data: tempData,
                    borderColor: 'rgb(255, 99, 132)',
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    fill: true,
                    tension: 0.3
                }]
            },
            options: {
                responsive: true,
                scales: {
                    x: { display: true },
                    y: { display: true, beginAtZero: false }
                }
            }
        });
    } else {
        chart.data.labels = timeLabels;
        chart.data.datasets[0].data = tempData;
        chart.update();
    }
}

// Első adatlekérés és frissítés interval
fetchData();
setInterval(fetchData, updateInterval);
</script>

</body>
</html>
